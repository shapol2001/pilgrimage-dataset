<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Pilgrims Dataset — Interactive Table & Charts</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

    <!-- DataTables -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css">

    <style>
        body { padding: 30px; }
        #chart { margin-top: 40px; }
    </style>
</head>
<body>

<h2>Паломнические и путевые записки (интерактивная таблица)</h2>

<table id="pilgrimsTable" class="display" style="width:100%"></table>

<hr>

<h4>Графики</h4>

<button class="btn btn-primary m-1" onclick="plotByYear()">Публикации по годам</button>
<button class="btn btn-primary m-1" onclick="plotByRegion()">География паломничеств</button>
<button class="btn btn-primary m-1" onclick="plotByAuthor()">Активность авторов</button>

<div id="chart"></div>

<!-- JQuery + DataTables -->
<script src="https://code.jquery.com/jquery-3.5.1.js"></script>
<script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>

<!-- Plotly -->
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

<script>
// Загружаем CSV через fetch
fetch("pilgrims.csv")
    .then(response => response.text())
    .then(csv => {
        const rows = csv.split("\n").map(r => r.split(","));

        const headers = rows[0];
        const data = rows.slice(1);

        $('#pilgrimsTable').DataTable({
            data: data,
            columns: headers.map(h => ({ title: h }))
        });

        window.pilgrimsData = { headers, data };
    });

// ---------- Графики ----------
function plotByYear() {
    const yearIndex = pilgrimsData.headers.indexOf("year");

    const counts = {};
    pilgrimsData.data.forEach(row => {
        const year = row[yearIndex];
        if (year) counts[year] = (counts[year] || 0) + 1;
    });

    Plotly.newPlot("chart", [{
        x: Object.keys(counts),
        y: Object.values(counts),
        type: "bar"
    }], { title: "Публикации по годам" });
}

function plotByRegion() {
    const index = pilgrimsData.headers.indexOf("region");

    const counts = {};
    pilgrimsData.data.forEach(row => {
        const region = row[index];
        if (region) counts[region] = (counts[region] || 0) + 1;
    });

    Plotly.newPlot("chart", [{
        labels: Object.keys(counts),
        values: Object.values(counts),
        type: "pie"
    }], { title: "География паломничеств" });
}

function plotByAuthor() {
    const index = pilgrimsData.headers.indexOf("author");

    const counts = {};
    pilgrimsData.data.forEach(row => {
        const author = row[index];
        if (author) counts[author] = (counts[author] || 0) + 1;
    });

    Plotly.newPlot("chart", [{
        x: Object.keys(counts),
        y: Object.values(counts),
        type: "bar"
    }], { title: "Активность авторов" });
}
</script>

</body>
</html>

