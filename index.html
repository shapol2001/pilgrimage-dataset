<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<script>
fetch("pilgrims.csv")
  .then(response => response.text())
  .then(csvText => {
    // Парсим CSV с помощью PapaParse
    const parsed = Papa.parse(csvText, { header: true, skipEmptyLines: true });
    window.pilgrimsData = parsed.data; // Массив объектов { Автор: ..., Дата издания: ..., Название: ... }

    // Таблица
    const headers = Object.keys(window.pilgrimsData[0]);
    $("#pilgrimsTable").DataTable({
      data: window.pilgrimsData.map(r => headers.map(h => r[h])),
      columns: headers.map(h => ({ title: h }))
    });

    plotByYear(); // первый график по умолчанию
  });

// Пример построения Timeline с новым CSV
function plotTimeline() {
  if (!window.pilgrimsData) return;

  const events = window.pilgrimsData.map(r => ({
    year: +r["Дата издания"],
    title: r["Название"]
  })).filter(e => e.year);

  Plotly.newPlot("timeline", [{
    x: events.map(e => e.year),
    y: events.map(() => 1),
    text: events.map(e => e.title),
    mode: "markers",
    type: "scatter"
  }], {
    title: "Timeline публикаций",
    yaxis: { visible: false }
  });
}
</script>
